$OpenBSD$

Index: newlib/libc/Makefile.in
--- newlib/libc/Makefile.in.orig
+++ newlib/libc/Makefile.in
@@ -408,6 +408,17 @@ libc_la_LDFLAGS = -Xcompiler -nostdlib
 @USE_LIBTOOL_TRUE@libc_la_LIBADD = $(SUBLIBS)
 @USE_LIBTOOL_TRUE@libc_la_DEPENDENCIES = $(SUBLIBS)
 
+# TENSILICA: add new dependencies for Tensilica-specific files
+EXTRA_TEXI_FILES = \
+	tensilica-version.texi \
+	tensilica-address.texi \
+	tensilica-legal-info.texi \
+	tensilica-legal-tex.texi
+
+XTENSA_SRC_DIR = $(srcdir)/../../../..
+XTENSA_DOC_DIR = $(XTENSA_SRC_DIR)/Software-doc
+XTENSA_MINORVERSION = ".2"
+
 # This is a list of the stmp-def files in each subdirectory which
 # builds .def files.  We don't list subdirectories which don't build
 # .def files; if the list of subdirectories changes, we must change
@@ -429,13 +440,13 @@ SUBDEFS = \
 
 info_TEXINFOS = libc.texinfo
 libc_TEXINFOS = sigset.texi extra.texi posix.texi stdio64.texi iconvset.texi \
-	targetdep.tex $(SUBDEFS)
+	targetdep.tex $(SUBDEFS) $(EXTRA_TEXI_FILES)
 
 CLEANFILES = $(CRT0) \
 	sigset.texi stmp-sigset extra.texi stmp-extra \
 	stdio64.texi stmp-stdio64 targetdep.tex stmp-targetdep \
 	tmp-sigset.texi tmp-iconvset.texi tmp-extra.texi \
-	tmp-stdio64.texi tmp-posix.texi tmp-targetdep.texi
+	tmp-stdio64.texi tmp-posix.texi tmp-targetdep.texi $(EXTRA_TEXI_FILES)
 
 ACLOCAL_AMFLAGS = -I .. -I ../..
 CONFIG_STATUS_DEPENDENCIES = $(newlib_basedir)/configure.host
@@ -1040,6 +1051,17 @@ crt0.o: sys/crt0.o
 	ln sys/crt0.o $@ >/dev/null 2>/dev/null || cp sys/crt0.o $@
 
 sys/crt0.o: ; @true
+
+tensilica-version.texi: $(XTENSA_DOC_DIR)/issue-date $(XTENSA_SRC_DIR)/version
+	majorversion=`sed -e 's/\(.*\)\..*/\1/' < $(XTENSA_SRC_DIR)/version`; \
+	echo "@set XTENSAVERSION $$majorversion$(XTENSA_MINORVERSION)" > $@
+	issuedate=`cat $(XTENSA_DOC_DIR)/issue-date`; \
+	echo "@set ISSUEDATE $$issuedate" >> $@
+
+tensilica-address.texi tensilica-legal-info.texi tensilica-legal-tex.texi: \
+	% : $(XTENSA_DOC_DIR)/%
+	rm -f $@
+	cp $< $@
 
 libc.info: sigset.texi extra.texi stdio64.texi posix.texi iconvset.texi \
 	targetdep.tex $(SUBDEFS)
